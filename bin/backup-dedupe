#!/usr/bin/env python3.6
import sys
import subprocess
index_raw = [x.strip().split('\t') for x in sys.stdin]
index = {blake2b: {'path': path, 'size': size} for path, tar, blake2b, size in index_raw}
proc = subprocess.Popen("git log -p|grep -P '^\+'|grep -P '.+\t.+\t.+\t.+'|sed 's/^\+//'|cut -f1-3", shell=True, executable='/bin/bash', stdout=subprocess.PIPE)
while True:
    line = proc.stdout.readline().decode('utf-8')
    if not line:
        break
    path, tar, blake2b = line.strip().split('\t')
    if blake2b in index:
        index[blake2b]['ref'] = f'ref::{tar}::{path}'
proc.wait()
for path, tar, blake2b, size in index_raw:
    if 'ref' in index[blake2b]:
        tar = index[blake2b]['ref']
    print('\t'.join([path, tar, blake2b, size]))
